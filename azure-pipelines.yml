# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'windows-2019'

steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $PesterModule = Get-Module -Name Pester -ListAvailable
      if (-Not($PesterModule.Version -gt '5.0.0')) {
      Install-Module -Name Pester -MinimumVersion 5.0.0 -Force -SkipPublisherCheck
      }
      
      Invoke-Pester -Script "./Tests/" -OutputFile "./Test-Pester.XML" -OutputFormat "NUnitXML"

- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'NUnit'
    testResultsFiles: '**/TEST-*.xml'
    failTaskOnFailedTests: true

